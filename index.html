<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Idle Miner Pro</title>
    <style>
        /* ... (прежние стили остаются без изменений) ... */
    </style>
</head>
<body>
    <!-- Контейнер и разметка остаются прежними -->
    
    <script>
        let gameState = {
            gold: 0,
            gps: 0,
            baseGPS: 0,
            clickPower: 1,
            level: 1,
            experience: 0,
            lastUpdate: Date.now(),
            upgrades: {
                miner1: { price: 10, gps: 1, count: 0 },
                miner2: { price: 50, gps: 5, count: 0 },
                clickUpgrade: { price: 20, power: 1, count: 0 },
                boost: { price: 100, multiplier: 2, duration: 30000, count: 0 }
            },
            achievements: {
                firstClick: false,
                firstUpgrade: false,
                firstMiner: false
            },
            activeBoosts: []
        };

        function loadGame() {
            const saved = localStorage.getItem('idleSave');
            if (saved) {
                const savedState = JSON.parse(saved);
                const currentTime = Date.now();
                const timeDiff = currentTime - savedState.lastUpdate;
                
                // Рассчет оффлайн-прогресса
                const secondsElapsed = Math.floor(timeDiff / 1000);
                savedState.gold += savedState.gps * secondsElapsed;
                
                gameState = savedState;
                gameState.lastUpdate = currentTime;
                updateGPS();
                updateUI();
            }
        }

        function saveGame() {
            gameState.lastUpdate = Date.now();
            localStorage.setItem('idleSave', JSON.stringify(gameState));
        }

        function updateUI() {
            document.getElementById('gold').textContent = Math.floor(gameState.gold);
            document.getElementById('gps').textContent = gameState.gps.toFixed(1);
            document.getElementById('clickPower').textContent = gameState.clickPower;
            document.getElementById('level').textContent = gameState.level;

            // Обновление цен
            document.getElementById('miner1Price').textContent = gameState.upgrades.miner1.price;
            document.getElementById('miner2Price').textContent = gameState.upgrades.miner2.price;
            document.getElementById('clickUpgradePrice').textContent = gameState.upgrades.clickUpgrade.price;
            document.getElementById('boostPrice').textContent = gameState.upgrades.boost.price;

            updateBuyButtons();
        }

        function updateGPS() {
            // Базовый GPS от шахтеров
            let baseGPS = 0;
            baseGPS += gameState.upgrades.miner1.count * gameState.upgrades.miner1.gps;
            baseGPS += gameState.upgrades.miner2.count * gameState.upgrades.miner2.gps;
            gameState.baseGPS = baseGPS;

            // Применение активных бустов
            const now = Date.now();
            let totalMultiplier = 1;
            gameState.activeBoosts = gameState.activeBoosts.filter(boost => {
                if (boost.expires > now) {
                    totalMultiplier *= boost.multiplier;
                    return true;
                }
                return false;
            });
            
            gameState.gps = gameState.baseGPS * totalMultiplier;
        }

        function buyUpgrade(type) {
            const upgrade = gameState.upgrades[type];
            if (gameState.gold >= upgrade.price) {
                gameState.gold -= upgrade.price;
                gameState.experience += 10;

                switch (type) {
                    case 'miner1':
                    case 'miner2':
                        upgrade.count++;
                        updateGPS();
                        if (!gameState.achievements.firstMiner) {
                            unlockAchievement('firstMiner');
                        }
                        break;
                    case 'clickUpgrade':
                        gameState.clickPower += upgrade.power;
                        if (!gameState.achievements.firstUpgrade) {
                            unlockAchievement('firstUpgrade');
                        }
                        break;
                    case 'boost':
                        applyBoost(upgrade.multiplier, upgrade.duration);
                        break;
                }
                
                increaseUpgradePrice(type);
                checkLevelUp();
                updateUI();
                saveGame();
            }
        }

        function applyBoost(multiplier, duration) {
            gameState.activeBoosts.push({
                multiplier: multiplier,
                expires: Date.now() + duration
            });
            updateGPS();
        }

        function checkLevelUp() {
            const requiredXP = gameState.level * 100;
            if (gameState.experience >= requiredXP) {
                gameState.level++;
                gameState.experience -= requiredXP;
                gameState.clickPower += Math.floor(gameState.level * 0.5);
                alert(`Уровень повышен! Текущий уровень: ${gameState.level}`);
            }
        }

        function unlockAchievement(achievement) {
            if (!gameState.achievements[achievement]) {
                gameState.achievements[achievement] = true;
                alert(`Достижение разблокировано: ${achievement}`);
                saveGame();
            }
        }

        // Остальные функции остаются без изменений

        // Инициализация игры
        loadGame();
        setInterval(() => {
            gameState.gold += gameState.gps;
            gameState.experience += gameState.gps * 0.1;
            checkLevelUp();
            updateUI();
            saveGame();
        }, 1000);

        // Обработчик клика
        document.getElementById('clickButton').addEventListener('click', () => {
            gameState.gold += gameState.clickPower;
            gameState.experience += 1;
            if (!gameState.achievements.firstClick) {
                unlockAchievement('firstClick');
            }
            document.getElementById('gold').classList.add('coin-animation');
            setTimeout(() => {
                document.getElementById('gold').classList.remove('coin-animation');
            }, 300);
            checkLevelUp();
            updateUI();
            saveGame();
        });
    </script>
</body>
</html>